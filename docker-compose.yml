services:
  datalake:
    build:
      context: .
      dockerfile: Dockerfile
    image: datalake:latest
    container_name: datalake

    # Environment variables (isolated per container)
    environment:
      - DATA_DIR=/data
      - DB_FILE=/data/datalake.db
      - LOG_DIR=/app/logs
      - PROJECT_ROOT=/app
      - SCHEMA_FILE=/app/schema.sql

    # Volume mounts
    volumes:
      # Persistent data storage
      - datalake-data:/data
      # Logs
      - datalake-logs:/app/logs
      # Database (optional: can also be in /data)
      - datalake-db:/app/db

    # Expose API port
    ports:
      - "8766:8766"

    # Keep container running for interactive use
    stdin_open: true
    tty: true

    # Default command: run API server
    command: ["/usr/local/bin/uv", "run", "uvicorn", "api.main:app", "--host", "0.0.0.0", "--port", "8766"]

    # Restart policy
    restart: unless-stopped

    # Resource limits (optional)
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 1G
        reservations:
          cpus: '0.5'
          memory: 256M

volumes:
  datalake-data:
    driver: local
  datalake-logs:
    driver: local
  datalake-db:
    driver: local
